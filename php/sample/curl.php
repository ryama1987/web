<?php 

//PHP処理プログラム

define('NOTION_SECREAT_KEY', 'secret_d2aCBehfFiGDXro5dQwAj78HqI5rVgK0tNR8MTgjDiP');
define('NOTION_TABLE_ID', '01d659c8c58d413487ac46f34ea04bc6');

//-----------------------------------------------------------------------------
// (1) cURL ヘッダー情報 設定
//-----------------------------------------------------------------------------
$header = [
  "Authorization: Bearer ".NOTION_SECREAT_KEY,
  "Content-Type: application/json",
  "Notion-Version: 2022-06-28"
];

//-----------------------------------------------------------------------------
// (2) cURL 取得したいデータ
//-----------------------------------------------------------------------------
$post_data = [
    "filter" => [
        "property" => "Name",
        "rich_text" => [
            "contains" => "KJ"
        ]
    ]
];
//-----------------------------------------------------------------------------
// (3) cURL セッション 初期化
//-----------------------------------------------------------------------------
$ch = curl_init("https://api.notion.com/v1/databases/".NOTION_TABLE_ID."/query");
//-----------------------------------------------------------------------------
// (4) cURL オプション 設定
//-----------------------------------------------------------------------------
curl_setopt_array($ch,
  [
    CURLOPT_RETURNTRANSFER  => true,
    CURLOPT_HTTPHEADER      => $header,
    CURLOPT_POST            => true,
    CURLOPT_POSTFIELDS      => json_encode($post_data),
  ]
);
//-----------------------------------------------------------------------------
// (5) cURL 実行
//-----------------------------------------------------------------------------
$result = curl_exec($ch);
//-----------------------------------------------------------------------------
// (6) cURL エラー処理
//-----------------------------------------------------------------------------
if (curl_errno($ch)) {
  $error = curl_error($ch);
  echo $error;
}
//-----------------------------------------------------------------------------
// (7) cURL システムリソース解放
//-----------------------------------------------------------------------------
curl_close($ch);
//-----------------------------------------------------------------------------
// (8) 結果画面表示
//-----------------------------------------------------------------------------
echo '<pre class="text-light">';
var_dump(json_decode($result, true));
echo '</pre>';

?>